<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Bali Elite Pro</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap');
        body { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; background: #0f172a; color: #fff; margin: 0; padding: 0; height: 100vh; }
        .glass { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.1); }
        .btn-primary { background: #3b82f6; box-shadow: 0 4px 20px rgba(59,130,246,0.4); }
        .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; }
        .page { display: none; height: 100vh; animation: fadeIn 0.3s ease; flex-direction: column; width: 100%; }
        .active { display: flex; }
        .lang-active { background: #3b82f6; color: white; }
        input, select { color-scheme: dark; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        ::-webkit-scrollbar { width: 0; }
        .duration-selected { border: 2px solid #3b82f6; background: #eff6ff; }
        .error-border { border-color: #ef4444 !important; }
    </style>
</head>
<body>
    <div id="app" class="max-w-md mx-auto relative h-screen flex flex-col bg-[#0f172a] overflow-hidden">
        
        <div class="absolute top-4 right-4 z-[100] flex glass rounded-full p-1">
            <button onclick="setLang('ru')" id="btn-ru" class="px-3 py-1 rounded-full text-[10px] font-bold transition-all">RU</button>
            <button onclick="setLang('en')" id="btn-en" class="px-3 py-1 rounded-full text-[10px] font-bold transition-all">EN</button>
        </div>

        <!-- STEP 1: Type Selection -->
        <div id="step-type" class="page active p-3 gap-3 overflow-y-auto">
            <div onclick="showCategory('bike')" class="relative h-60 rounded-[32px] overflow-hidden cursor-pointer active:scale-[0.98] transition-all flex-shrink-0 mt-2">
                <img src="https://images.unsplash.com/photo-1558981403-c5f9899a28bc?w=800&q=80" class="absolute inset-0 w-full h-full object-cover" alt="Motorcycles">
                <div class="absolute inset-0 bg-gradient-to-t from-black/90 via-transparent to-transparent"></div>
                <div class="absolute bottom-6 left-6 right-6">
                    <span class="bg-blue-600/80 backdrop-blur px-3 py-1 rounded-lg text-[10px] font-bold uppercase tracking-widest text-white mb-2 inline-block" id="lbl-rent-bike">Rent a Bike</span>
                    <h2 class="text-3xl font-black italic uppercase tracking-tighter" id="lbl-moto">MOTORCYCLES</h2>
                    <p class="text-gray-300 text-xs mt-1" id="lbl-start-bike">From 150k IDR / day</p>
                </div>
            </div>

            <div onclick="showCategory('car')" class="relative h-60 rounded-[32px] overflow-hidden cursor-pointer active:scale-[0.98] transition-all flex-shrink-0">
                <img src="https://images.unsplash.com/photo-1549317661-bd32c8ce0db2?w=800&q=80" class="absolute inset-0 w-full h-full object-cover" alt="Cars">
                <div class="absolute inset-0 bg-gradient-to-t from-black/90 via-transparent to-transparent"></div>
                <div class="absolute bottom-6 left-6 right-6">
                    <span class="bg-blue-600/80 backdrop-blur px-3 py-1 rounded-lg text-[10px] font-bold uppercase tracking-widest text-white mb-2 inline-block" id="lbl-rent-car">Rent a Car</span>
                    <h2 class="text-3xl font-black italic uppercase tracking-tighter" id="lbl-cars">PREMIUM CARS</h2>
                    <p class="text-gray-300 text-xs mt-1" id="lbl-start-car">From 300k IDR / day</p>
                </div>
            </div>
            
            <div class="mt-auto py-10 px-4">
                <p class="text-[10px] font-medium text-white/30 text-center uppercase tracking-[0.3em] mb-3">Bali Elite Pro</p>
                <p class="text-[14px] font-semibold text-white/90 text-center leading-relaxed italic" id="lbl-footer-main">
                    –ü—Ä–µ–º–∏–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–∏—Å –∞—Ä–µ–Ω–¥—ã –Ω–∞ –ë–∞–ª–∏.<br>–í–∞—à –∫–æ–º—Ñ–æ—Ä—Ç ‚Äî –Ω–∞—à –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç.
                </p>
            </div>
        </div>

        <!-- STEP 2: List of Vehicles -->
        <div id="step-list" class="page bg-[#f1f5f9] text-slate-900 overflow-hidden">
            <div class="p-4 bg-white shadow-sm flex items-center justify-between sticky top-0 z-50">
                <button onclick="showPage('step-type')" class="p-2 rounded-xl bg-slate-100 text-blue-600 font-bold">‚Üê</button>
                <h2 class="text-lg font-black uppercase tracking-widest" id="lbl-category">CATEGORY</h2>
                <div class="w-8"></div>
            </div>
            <div id="items-container" class="space-y-4 p-4 pb-32 overflow-y-auto flex-1 h-full"></div>
        </div>

        <!-- STEP 3: Details & Booking -->
        <div id="step-details" class="page bg-white text-slate-900 overflow-hidden relative">
            <div class="flex-1 overflow-y-auto pb-40">
                <div class="relative h-64">
                    <img id="det-img" src="" class="w-full h-full object-cover bg-gray-100" alt="Vehicle image">
                    <button onclick="showPage('step-list')" class="absolute top-4 left-4 bg-white/90 p-2 rounded-xl text-slate-900 shadow-lg z-[70] font-bold">‚Üê <span id="lbl-back-btn">Back</span></button>
                    <div class="absolute bottom-0 left-0 w-full h-24 bg-gradient-to-t from-white to-transparent"></div>
                </div>

                <div class="px-6 -mt-8 relative z-20">
                    <h2 id="det-model" class="text-3xl font-black text-slate-900 leading-tight mb-2">Model</h2>
                    <span id="det-specs" class="bg-blue-100 text-blue-600 px-3 py-1 rounded-lg text-[10px] font-bold uppercase tracking-widest">Specs</span>
                    <p id="det-desc" class="text-sm text-gray-500 mt-4 leading-relaxed"></p>

                    <p class="text-xs font-bold text-slate-400 uppercase mt-6 mb-3" id="lbl-tariffs">Select Duration</p>
                    <div class="grid grid-cols-3 gap-2">
                        <div onclick="selectDuration(1)" id="dur-1" class="border border-gray-200 p-3 rounded-2xl text-center cursor-pointer active:scale-95 transition-all">
                            <p class="text-[9px] uppercase font-bold text-gray-400" id="lbl-day">Day</p>
                            <p id="p-day" class="font-bold text-slate-900 text-xs">-</p>
                        </div>
                        <div onclick="selectDuration(7)" id="dur-7" class="border border-gray-200 p-3 rounded-2xl text-center cursor-pointer active:scale-95 transition-all">
                            <p class="text-[9px] uppercase font-bold text-green-500" id="lbl-week">Week</p>
                            <p id="p-week" class="font-bold text-slate-900 text-xs">-</p>
                        </div>
                        <div onclick="selectDuration(30)" id="dur-30" class="border border-gray-200 p-3 rounded-2xl text-center cursor-pointer active:scale-95 transition-all">
                            <p class="text-[9px] uppercase font-bold text-blue-500" id="lbl-month">Month</p>
                            <p id="p-month" class="font-bold text-slate-900 text-xs">-</p>
                        </div>
                    </div>

                    <div class="mt-6 bg-slate-50 p-4 rounded-[24px] border border-slate-100 space-y-4">
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="text-[10px] font-bold text-gray-400 uppercase ml-1" id="lbl-start-date">Start</label>
                                <input type="date" id="inp-start" class="w-full bg-white p-2 rounded-xl text-sm font-bold border border-gray-200 outline-none" onchange="validateDates()">
                            </div>
                            <div>
                                <label class="text-[10px] font-bold text-gray-400 uppercase ml-1" id="lbl-end-date">End</label>
                                <input type="date" id="inp-end" class="w-full bg-white p-2 rounded-xl text-sm font-bold border border-gray-200 outline-none" onchange="validateDates()">
                            </div>
                        </div>
                        <div class="flex gap-2">
                            <input type="text" id="inp-address" class="flex-1 bg-white p-3 rounded-xl text-xs border border-gray-200 outline-none" placeholder="Villa address">
                            <button onclick="getMyLocation()" class="bg-blue-100 text-blue-600 p-3 rounded-xl text-xs font-bold active:scale-90">üìç</button>
                        </div>
                        <input type="text" id="inp-time" class="w-full bg-white p-3 rounded-xl text-xs border border-gray-200 outline-none" placeholder="Delivery time">
                    </div>
                </div>
            </div>

            <div class="fixed bottom-0 left-0 w-full bg-white border-t border-gray-100 p-4 pb-8 z-[80] shadow-[0_-5px_20px_rgba(0,0,0,0.05)]">
                <div class="flex items-center justify-between mb-3 px-2">
                    <span class="text-xs font-bold text-gray-400" id="lbl-total-days">0 Days</span>
                    <span id="display-total" class="text-2xl font-black text-blue-600">0 IDR</span>
                </div>
                <button onclick="finishOrder()" id="btn-book" class="w-full btn-primary text-white py-4 rounded-2xl font-black uppercase text-sm active:scale-95 transition-all">Book</button>
            </div>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.enableClosingConfirmation();
        
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π URL –¥–ª—è Google Apps Script
        // –í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Å–≤–æ–π
        const GOOGLE_URL = "https://script.google.com/macros/s/AKfycbwbLnBjJ1V2FIordSt2gTbodL3UH15EWpm6pOiWiFAFGJHAOagiWHYd9mFiKqdph0Qw/exec";
        
        const db = [
            { id: 1, type: 'bike', model: 'Yamaha NMax 155 (2022)', prices: {day:150000, week:1000000, month:2500000}, img: 'https://yamaha-motor.id/wp-content/uploads/2023/04/Nmax-ABS-2-600x400.png', specs: 'Standard', desc: {ru: '–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –∏ –Ω–∞–¥–µ–∂–Ω—ã–π NMax 155.', en: 'Classic and reliable NMax 155.'}},
            { id: 2, type: 'bike', model: 'Yamaha NMax New (2025)', prices: {day:200000, week:1300000, month:2700000}, img: 'https://brdsg.com/img/800/bw5d48ohbw5jup2tq9_3/CT79WSw0akV4fenCTIXNpDJVwe6BJTXCLRs2cLNUJNQ.png', specs: 'New Gen | ABS', desc: {ru: '–ù–æ–≤—ã–π –∫—É–∑–æ–≤ 2025 –≥–æ–¥–∞, LED –æ–ø—Ç–∏–∫–∞, Bluetooth.', en: 'New 2025 body, LED, Bluetooth.'}},
            { id: 3, type: 'bike', model: 'Yamaha NMax (2026)', prices: {day:200000, week:1300000, month:2700000}, img: 'https://imgcdn.oto.com/large/gallery/exterior/84/2967/yamaha-nmax-turbo-slant-rear-view-full-image-125296.jpg', specs: '2026 Model', desc: {ru: '–°–∞–º–∞—è —Å–≤–µ–∂–∞—è –º–æ–¥–µ–ª—å 2026 –≥–æ–¥–∞.', en: 'Latest 2026 model.'}},
            { id: 4, type: 'bike', model: 'Yamaha XMax 250 (2023)', prices: {day:249000, week:1900000, month:3500000}, img: 'https://yamaha-motor.id/wp-content/uploads/2023/04/Xmax-2-600x400.png', specs: '250cc | Maxi', desc: {ru: '–ú–∞–∫—Å–∏-—Å–∫—É—Ç–µ—Ä –¥–ª—è –∫–æ–º—Ñ–æ—Ä—Ç–Ω—ã—Ö –ø–æ–µ–∑–¥–æ–∫.', en: 'Comfortable maxi-scooter.'}},
            { id: 5, type: 'bike', model: 'XMax Tech Max (2026)', prices: {day:250000, week:2700000, month:4200000}, img: 'https://www.yamahamotor.co.id/wp-content/uploads/2024/10/Yamaha-nmax-Turbo-Tech-MAX-Magma-Black-1.png', specs: 'Tech Max 2026', desc: {ru: '–ü—Ä–µ–º–∏–∞–ª—å–Ω–∞—è –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏—è Tech Max.', en: 'Premium Tech Max edition.'}},
            { id: 6, type: 'bike', model: 'Honda ADV 160', prices: {day:200000, week:1300000, month:2700000}, img: 'https://honda-motor.id/wp-content/uploads/2024/02/Honda-ADV-160-ABS-Tough-Matte-White-1.png', specs: 'Adventure', desc: {ru: '–°–∫—É—Ç–µ—Ä –ø–æ–≤—ã—à–µ–Ω–Ω–æ–π –ø—Ä–æ—Ö–æ–¥–∏–º–æ—Å—Ç–∏.', en: 'Adventure style scooter.'}},
            { id: 7, type: 'car', model: 'Honda Brio', prices: {day:350000, week:2000000, month:5000000}, img: 'https://upload.wikimedia.org/wikipedia/commons/2/2e/2020_Honda_Brio_Satya_S_1.2_DD1_%2820211001%29_01.jpg', specs: 'Compact', desc: {ru: '–≠–∫–æ–Ω–æ–º–∏—á–Ω—ã–π –∏ —é—Ä–∫–∏–π –≥–æ—Ä–æ–¥—Å–∫–æ–π –∞–≤—Ç–æ–º–æ–±–∏–ª—å.', en: 'Economic and agile city car.'}},
            { id: 8, type: 'car', model: 'Mitsubishi Xpander', prices: {day:450000, week:3500000, month:8000000}, img: 'https://cdn.motor1.com/images/mgl/A8J36/s1/2020-mitsubishi-xpander-cross.webp', specs: 'Premium MPV', desc: {ru: '7-–º–µ—Å—Ç–Ω—ã–π –ø—Ä–æ—Å—Ç–æ—Ä–Ω—ã–π –∫—Ä–æ—Å—Å–æ–≤–µ—Ä.', en: '7-seater spacious crossover.'}},
            { id: 9, type: 'bike', model: 'Yamaha XMax 250 (2025)', prices: {day:250000, week:2700000, month:4000000}, img: 'https://yamaha-motor.id/wp-content/uploads/2023/04/Xmax-2-600x400.png', specs: '250cc | New Gen', desc: {ru: '–ú–æ–¥–µ–ª—å 2025 –≥–æ–¥–∞. –ö–æ–º—Ñ–æ—Ä—Ç –∏ –º–æ—â—å.', en: '2025 model. Power and comfort.'}},
            { id: 10, type: 'bike', model: 'Honda ADV 160 (2026)', prices: {day:200000, week:1900000, month:2700000}, img: 'https://imgcdn.oto.com/large/gallery/exterior/73/2617/honda-adv-160-slant-rear-view-full-image-937505.jpg', specs: 'ABS | 2026', desc: {ru: '–û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è 2026 –≥–æ–¥–∞ —Å ABS.', en: 'Updated 2026 version with ABS.'}},
            { id: 11, type: 'bike', model: 'Honda PCX 160 (2022)', prices: {day:150000, week:1000000, month:2500000}, img: 'https://thumb.katadata.co.id/frontend/thumbnail/2022/12/14/zigi-63992e5298583-dijual-rp32-juta-new-honda-pcx-160-tampil-dengan-warna-baru_665_374.jpg', specs: 'CBS | 160cc', desc: {ru: '–ù–∞–¥–µ–∂–Ω—ã–π –≥–æ—Ä–æ–¥—Å–∫–æ–π —Å–∫—É—Ç–µ—Ä.', en: 'Reliable city scooter.'}},
            { id: 12, type: 'bike', model: 'Honda PCX 160 (2026)', prices: {day:200000, week:1300000, month:2700000}, img: 'https://img.autofun.co.id/file/178d31a78c9e4c29a61bc09372781775.jpg', specs: 'ABS | 2026', desc: {ru: '–¢–æ–ø–æ–≤–∞—è –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏—è 2026 –≥–æ–¥–∞.', en: 'Top edition 2026 model.'}},
            { id: 13, type: 'bike', model: 'Yamaha XSR 155', prices: {day:200000, week:1300000, month:2900000}, img: 'https://yamahamotorjabodetabek.id/wp-content/uploads/2023/11/XSR-Matte-Silver-Premium.png', specs: 'Retro Style', desc: {ru: '–°—Ç–∏–ª—å–Ω—ã–π —Ä–µ—Ç—Ä–æ-–±–∞–π–∫ –¥–ª—è —Ü–µ–Ω–∏—Ç–µ–ª–µ–π.', en: 'Stylish retro-bike.'}},
            { id: 14, type: 'bike', model: 'Honda Stylo 160', prices: {day:150000, week:1000000, month:1700000}, img: 'https://honda-motor.id/wp-content/uploads/2024/02/Stylo-160-CBS-Glam-Black.png', specs: 'Fashionable', desc: {ru: '–ù–æ–≤–∏–Ω–∫–∞ –≤ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–º —Å—Ç–∏–ª–µ.', en: 'Classic fashion scooter.'}},
            { id: 15, type: 'bike', model: 'Honda Scoopy', prices: {day:150000, week:1000000, month:1700000}, img: 'https://cdn.antaranews.com/cache/1200x800/2024/11/18/New-Honda-Scoopy-Prestige-White.jpg', specs: 'Classic 110cc', desc: {ru: '–õ–µ–≥–∫–∏–π –∏ —Å—Ç–∏–ª—å–Ω—ã–π —Å–∫—É—Ç–µ—Ä.', en: 'Light and stylish scooter.'}},
            { id: 16, type: 'bike', model: 'Yamaha Grand Filano', prices: {day:150000, week:1000000, month:1700000}, img: 'https://yamahametro.com/wp-content/uploads/2023/10/FILANO-NEO5.jpg', specs: 'Hybrid', desc: {ru: '–ü—Ä–µ–º–∏–∞–ª—å–Ω—ã–π –≥–∏–±—Ä–∏–¥–Ω—ã–π —Å–∫—É—Ç–µ—Ä.', en: 'Premium hybrid scooter.'}},
            { id: 17, type: 'bike', model: 'Yamaha Fazzio', prices: {day:150000, week:1000000, month:1700000}, img: 'https://www.tjahaja-baru.com/uploads/products/thumbnail/29d13bc7850504f7772ae1d65835aaf0.png', specs: 'Smart Hybrid', desc: {ru: '–ú–æ–ª–æ–¥–µ–∂–Ω—ã–π –∏ —ç–∫–æ–Ω–æ–º–∏—á–Ω—ã–π.', en: 'Modern and economic.'}},
            { id: 18, type: 'bike', model: 'Yamaha Lexi 155', prices: {day:150000, week:1000000, month:1700000}, img: 'https://imgcdn.oto.com/large/gallery/color/84/2870/yamaha-lexi-lx-155-color-518959.jpg', specs: 'VVA | 155cc', desc: {ru: '–£–¥–æ–±–Ω—ã–π –±–∞–π–∫ —Å –ø–ª–æ—Å–∫–∏–º –ø–æ–ª–æ–º.', en: 'Comfortable bike with flat floor.'}},
            { id: 19, type: 'bike', model: 'Yamaha Aerox 155', prices: {day:150000, week:1000000, month:2500000}, img: 'https://www.auksi.co.id/get-image/artikel/1711412949MotorYamahaAerox155.png', specs: 'Sporty', desc: {ru: '–°–ø–æ—Ä—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω –∏ –¥–∏–Ω–∞–º–∏–∫–∞.', en: 'Sporty design and dynamics.'}},
            { id: 20, type: 'bike', model: 'Honda Vario 160', prices: {day:150000, week:1000000, month:1700000}, img: 'https://imgcdn.oto.com/large/gallery/color/73/2569/honda-vario-160-color-223651.jpg', specs: 'Powerful 160cc', desc: {ru: '–†–µ–∑–≤—ã–π –≥–æ—Ä–æ–¥—Å–∫–æ–π —Å–∫—É—Ç–µ—Ä.', en: 'Fast city scooter.'}},
            { id: 21, type: 'bike', model: 'Yamaha Gear 125', prices: {day:150000, week:1000000, month:1700000}, img: 'https://yamaha-motor.id/wp-content/uploads/2023/04/Gear-std-2-600x400.png', specs: 'Compact 125cc', desc: {ru: '–ö–æ–º–ø–∞–∫—Ç–Ω—ã–π –∏ –Ω–∞–¥–µ–∂–Ω—ã–π.', en: 'Compact and reliable.'}},
            { id: 22, type: 'bike', model: 'Vespa Sprint (2026)', prices: {day:175000, week:2500000, month:2900000}, img: 'https://imgcdn.oto.com/large/gallery/exterior/87/1114/vespa-sprint-slant-front-view-full-image-819066.jpg', specs: 'Italian Style', desc: {ru: '–ò—Ç–∞–ª—å—è–Ω—Å–∫–∏–π —Å—Ç–∏–ª—å 2026 –≥–æ–¥–∞.', en: 'Italian style 2026.'}},
            { id: 23, type: 'bike', model: 'Kawasaki Ninja FI', prices: {day:350000, week:2500000, month:6000000}, img: 'https://kawasaki-global-admin.com/ContentStorage/KMI/ProductTopFeature/1229/86ed658d-e280-47e9-88cc-9d80167dfc64.jpg?w=800', specs: '2 Cylinder Sport', desc: {ru: '–ú–æ—â–Ω—ã–π —Å–ø–æ—Ä—Ç–∏–≤–Ω—ã–π –±–∞–π–∫.', en: 'Powerful sports bike.'}},
            { id: 24, type: 'bike', model: 'Kawasaki ZX-25R', prices: {day:650000, week:4000000, month:10000000}, img: 'https://cdn.antaranews.com/cache/1200x800/2020/07/10/WhatsApp-Image-2020-07-10-at-16.38.58.jpeg', specs: '4 Cylinder | 250cc', desc: {ru: '–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–µ 4 —Ü–∏–ª–∏–Ω–¥—Ä–∞. –ó–≤—É–∫ –∏ –º–æ—â—å.', en: 'Legendary 4 cylinders.'}},
            { id: 25, type: 'bike', model: 'Kawasaki KLX 150', prices: {day:200000, week:1300000, month:2900000}, img: 'https://www.static-src.com/wcsstore/Indraprastha/images/catalog/full/catalog-image/MTA-182277670/kawasaki_kawasaki_klx_150_se_sepeda_motor_-otr_jabodetabekser-_full07_rp2ogfbd.png', specs: 'Off-road', desc: {ru: '–î–ª—è –±–µ–∑–¥–æ—Ä–æ–∂—å—è –∏ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–π.', en: 'For off-road and adventures.'}},
            { id: 26, type: 'bike', model: 'Honda CRF 150L', prices: {day:200000, week:1300000, month:2900000}, img: 'https://cdn.antaranews.com/cache/1200x800/2021/10/26/Extreme-Green.jpg', specs: 'Enduro', desc: {ru: '–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —ç–Ω–¥—É—Ä–æ –±–∞–π–∫.', en: 'Universal enduro bike.'}},
            { id: 27, type: 'bike', model: 'Harley Davidson', prices: {day:3500000, week:7500000, month:25000000}, img: 'https://htcms-prod-images.s3.ap-south-1.amazonaws.com/ht/auto/cms-images/harleydavidson_custom1250/images/exterior_harleydavidson-custom1250_right-view_600x400.jpeg', specs: 'Luxury Expensive', desc: {ru: '–ü—Ä–µ–º–∏–∞–ª—å–Ω—ã–π –∫—Ä—É–∏–∑–µ—Ä –¥–ª—è VIP.', en: 'Luxury cruiser for VIP.'}},
            { id: 28, type: 'car', model: 'Toyota Raize', prices: {day:350000, week:2500000, month:7500000}, img: 'https://auto2000ciledug.id/wp-content/uploads/2024/08/10-raize-white-black.png', specs: 'Compact SUV', desc: {ru: '–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –∫—Ä–æ—Å—Å–æ–≤–µ—Ä –¥–ª—è –≥–æ—Ä–æ–¥–∞.', en: 'Modern city crossover.'}},
            { id: 29, type: 'car', model: 'Toyota Avanza', prices: {day:350000, week:2500000, month:7500000}, img: 'https://d1g6w7sntckt92.cloudfront.net/public/images/car_gallery_images/I3eUoPLccBunM3QyAfF0DbtNUgi1wP60VRRjt7zM.jpg', specs: '7-Seater Family', desc: {ru: '–°–∞–º—ã–π –ø–æ–ø—É–ª—è—Ä–Ω—ã–π —Å–µ–º–µ–π–Ω—ã–π –∞–≤—Ç–æ.', en: 'Most popular family car.'}},
            { id: 30, type: 'car', model: 'Honda CR-V RS', prices: {day:650000, week:4500000, month:13500000}, img: 'https://hondatugu.marketing/wp-content/uploads/2023/07/63lj249eFZNHiaMRUDed7S5hQZPhsptDLBsyMqiJ-600x343.png', specs: 'Premium SUV', desc: {ru: '–õ—é–∫—Å–æ–≤—ã–π –∫—Ä–æ—Å—Å–æ–≤–µ—Ä —Å –∫–æ–º—Ñ–æ—Ä—Ç–æ–º –±–∏–∑–Ω–µ—Å-–∫–ª–∞—Å—Å–∞.', en: 'Luxury SUV with business class comfort.'}}
        ];

        const i18n = {
            ru: {
                rent_bike: "–ê—Ä–µ–Ω–¥–∞ –ú–æ—Ç–æ", moto_title: "–ú–û–¢–û–¶–ò–ö–õ–´", start: "–û—Ç", rent_car: "–ê—Ä–µ–Ω–¥–∞ –ê–≤—Ç–æ", car_title: "–ê–í–¢–û–ú–û–ë–ò–õ–ò",
                footer_main: "–ü—Ä–µ–º–∏–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–∏—Å –∞—Ä–µ–Ω–¥—ã –Ω–∞ –ë–∞–ª–∏.<br>–í–∞—à –∫–æ–º—Ñ–æ—Ä—Ç ‚Äî –Ω–∞—à –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç.",
                cat: "–ö–ê–¢–ï–ì–û–†–ò–Ø", back: "–ù–∞–∑–∞–¥", day: "–î–µ–Ω—å", week: "–ù–µ–¥–µ–ª—è", month: "–ú–µ—Å—è—Ü",
                tariffs: "–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ä–æ–∫ –∞—Ä–µ–Ω–¥—ã", book: "–ó–ê–ë–†–û–ù–ò–†–û–í–ê–¢–¨", confirm: "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –±—Ä–æ–Ω—å", sent: "‚úÖ –ó–∞–∫–∞–∑ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!", error: "–û—à–∏–±–∫–∞ —Å–µ—Ç–∏",
                addr_ph: "–ê–¥—Ä–µ—Å –≤–∏–ª–ª—ã / –æ—Ç–µ–ª—è", time_ph: "–í—Ä–µ–º—è (–Ω–∞–ø—Ä. 10:00)", days: "–¥–Ω–µ–π", start_lbl: "–ù–∞—á–∞–ª–æ", end_lbl: "–ö–æ–Ω–µ—Ü",
                enter_addr: "–í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å", date_error: "–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–∞–Ω—å—à–µ –Ω–∞—á–∞–ª–∞", 
                select_vehicle: "–í—ã–±–µ—Ä–∏—Ç–µ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç", loading: "–û—Ç–ø—Ä–∞–≤–∫–∞...",
                get_location: "–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è", allow_location: "–†–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏"
            },
            en: {
                rent_bike: "Rent a Bike", moto_title: "MOTORCYCLES", start: "From", rent_car: "Rent a Car", car_title: "PREMIUM CARS",
                footer_main: "Premium rental service in Bali.<br>Your comfort is our priority.",
                cat: "CATEGORY", back: "Back", day: "Day", week: "Week", month: "Month",
                tariffs: "Select Rental Duration", book: "BOOK NOW", confirm: "Confirm Booking", sent: "‚úÖ Order Sent!", error: "Network Error",
                addr_ph: "Villa Address / Hotel", time_ph: "Time (e.g. 10:00 AM)", days: "days", start_lbl: "Start", end_lbl: "End",
                enter_addr: "Enter address", date_error: "End date cannot be earlier than start", 
                select_vehicle: "Select vehicle", loading: "Sending...",
                get_location: "Getting location", allow_location: "Allow access to geolocation"
            }
        };

        let state = { 
            lang: 'ru', 
            item: null,
            selectedDuration: 1
        };
        
        function setLang(lang) {
            state.lang = lang;
            document.getElementById('btn-ru').classList.toggle('lang-active', lang === 'ru');
            document.getElementById('btn-en').classList.toggle('lang-active', lang === 'en');
            updateUI();
        }

        function updateUI() {
            const t = i18n[state.lang];
            document.getElementById('lbl-rent-bike').innerText = t.rent_bike;
            document.getElementById('lbl-moto').innerText = t.moto_title;
            document.getElementById('lbl-start-bike').innerText = `${t.start} 150k IDR`;
            document.getElementById('lbl-rent-car').innerText = t.rent_car;
            document.getElementById('lbl-cars').innerText = t.car_title;
            document.getElementById('lbl-start-car').innerText = `${t.start} 300k IDR`;
            document.getElementById('lbl-footer-main').innerHTML = t.footer_main;
            document.getElementById('lbl-category').innerText = t.cat;
            document.getElementById('lbl-back-btn').innerText = t.back;
            document.getElementById('lbl-tariffs').innerText = t.tariffs;
            document.getElementById('lbl-day').innerText = t.day;
            document.getElementById('lbl-week').innerText = t.week;
            document.getElementById('lbl-month').innerText = t.month;
            document.getElementById('lbl-start-date').innerText = t.start_lbl;
            document.getElementById('lbl-end-date').innerText = t.end_lbl;
            document.getElementById('inp-address').placeholder = t.addr_ph;
            document.getElementById('inp-time').placeholder = t.time_ph;
            document.getElementById('btn-book').innerText = t.book;
            if (state.item) renderDetails(state.item);
        }

        function showPage(id) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.getElementById(id).scrollTop = 0;
        }

        function showCategory(type) {
            const container = document.getElementById('items-container');
            const items = db.filter(i => i.type === type);
            
            container.innerHTML = '';
            
            if (items.length === 0) {
                container.innerHTML = `<div class="text-center py-8 text-gray-500">No vehicles available</div>`;
                return;
            }
            
            items.forEach(item => {
                const pricePerDay = (item.prices.day / 1000).toFixed(0);
                container.innerHTML += `
                    <div onclick="openDetails(${item.id})" class="bg-white rounded-[24px] p-4 flex gap-4 shadow-sm border border-slate-100 active:scale-95 transition-all cursor-pointer">
                        <div class="w-24 h-24 rounded-2xl bg-gray-100 overflow-hidden flex-shrink-0">
                            <img src="${item.img}" class="w-full h-full object-cover" onerror="this.src='https://via.placeholder.com/150/cccccc/ffffff?text=No+Image'" alt="${item.model}">
                        </div>
                        <div class="flex-1 py-1">
                            <h3 class="font-black text-lg leading-tight text-slate-900">${item.model}</h3>
                            <p class="text-[10px] font-bold text-gray-400 uppercase tracking-wider mt-1 mb-2">${item.specs}</p>
                            <div class="inline-block bg-blue-50 text-blue-600 px-3 py-1 rounded-lg text-xs font-bold">
                                ${pricePerDay}k / ${i18n[state.lang].day}
                            </div>
                        </div>
                    </div>
                `;
            });
            showPage('step-list');
        }

        function openDetails(id) {
            try {
                state.item = db.find(i => i.id === id);
                if (!state.item) {
                    console.error('Item not found:', id);
                    tg.showAlert("–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω");
                    return;
                }
                renderDetails(state.item);
                showPage('step-details');
            } catch (error) {
                console.error('Error in openDetails:', error);
                tg.showAlert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –¥–µ—Ç–∞–ª–µ–π");
            }
        }

        function renderDetails(item) {
            document.getElementById('det-img').src = item.img;
            document.getElementById('det-model').innerText = item.model;
            document.getElementById('det-specs').innerText = item.specs;
            document.getElementById('det-desc').innerText = item.desc[state.lang];
            document.getElementById('p-day').innerText = (item.prices.day/1000).toFixed(0) + 'k';
            document.getElementById('p-week').innerText = (item.prices.week/1000000).toFixed(1) + 'M';
            document.getElementById('p-month').innerText = (item.prices.month/1000000).toFixed(1) + 'M';
            
            // Reset duration selection
            [1,7,30].forEach(d => {
                const el = document.getElementById(`dur-${d}`);
                if (el) el.classList.remove('duration-selected');
            });
            const selectedEl = document.getElementById(`dur-${state.selectedDuration}`);
            if (selectedEl) selectedEl.classList.add('duration-selected');
            
            // Set default dates
            const today = new Date();
            const tomorrow = new Date();
            tomorrow.setDate(today.getDate() + state.selectedDuration);
            
            document.getElementById('inp-start').valueAsDate = today;
            document.getElementById('inp-end').valueAsDate = tomorrow;
            
            calcTotal();
        }

        function selectDuration(days) {
            state.selectedDuration = days;
            [1,7,30].forEach(d => {
                const el = document.getElementById(`dur-${d}`);
                if (el) el.classList.remove('duration-selected');
            });
            const selectedEl = document.getElementById(`dur-${days}`);
            if (selectedEl) selectedEl.classList.add('duration-selected');
            
            const startInput = document.getElementById('inp-start');
            const endInput = document.getElementById('inp-end');
            
            if (startInput.value) {
                const start = new Date(startInput.value);
                const end = new Date(start);
                end.setDate(start.getDate() + days);
                endInput.valueAsDate = end;
            }
            validateDates();
        }

        function validateDates() {
            const start = document.getElementById('inp-start');
            const end = document.getElementById('inp-end');
            
            if (start) start.classList.remove('error-border');
            if (end) end.classList.remove('error-border');
            
            if (!start.value || !end.value) {
                calcTotal();
                return;
            }
            
            const startDate = new Date(start.value);
            const endDate = new Date(end.value);
            
            if (endDate < startDate) {
                if (end) end.classList.add('error-border');
                tg.showAlert(i18n[state.lang].date_error);
                document.getElementById('display-total').innerText = "0 IDR";
                return;
            }
            
            calcTotal();
        }

        function calcTotal() {
            const sVal = document.getElementById('inp-start').value;
            const eVal = document.getElementById('inp-end').value;
            
            if(!sVal || !eVal || !state.item) {
                document.getElementById('display-total').innerText = "0 IDR";
                return null;
            }

            const start = new Date(sVal);
            const end = new Date(eVal);
            const days = Math.ceil((end - start) / (1000 * 60 * 60 * 24)); 

            if (days <= 0) {
                document.getElementById('display-total').innerText = "0 IDR";
                document.getElementById('lbl-total-days').innerText = "0 " + i18n[state.lang].days;
                return { price: 0, days: 0 };
            }

            let price = 0;
            const p = state.item.prices;
            
            if (days >= 30) price = (p.month / 30) * days;
            else if (days >= 7) price = (p.week / 7) * days;
            else price = p.day * days;

            price = Math.ceil(price / 1000) * 1000;
            document.getElementById('display-total').innerText = price.toLocaleString() + " IDR";
            document.getElementById('lbl-total-days').innerText = days + " " + i18n[state.lang].days;
            return { price, days };
        }

        function getMyLocation() {
            if (navigator.geolocation) {
                tg.showConfirm(
                    i18n[state.lang].allow_location,
                    "OK",
                    (confirmed) => {
                        if (confirmed) {
                            navigator.geolocation.getCurrentPosition(
                                (pos) => {
                                    const link = `https://www.google.com/maps?q=${pos.coords.latitude},${pos.coords.longitude}`;
                                    document.getElementById('inp-address').value = link;
                                },
                                () => {
                                    tg.showAlert("Location access denied or failed");
                                }
                            );
                        }
                    }
                );
            } else {
                tg.showAlert("Geolocation not supported");
            }
        }

        async function finishOrder() {
            const calc = calcTotal();
            if (!calc || calc.days <= 0) {
                tg.showAlert(i18n[state.lang].select_vehicle);
                return;
            }
            
            const addr = document.getElementById('inp-address').value;
            if(!addr) {
                tg.showAlert(i18n[state.lang].enter_addr);
                return;
            }

            tg.showConfirm(`${i18n[state.lang].confirm} ${state.item.model}?`, async (ok) => {
                if(!ok) return;
                
                const order = {
                    user: tg.initDataUnsafe?.user?.username || tg.initDataUnsafe?.user?.first_name || "Guest",
                    user_id: tg.initDataUnsafe?.user?.id || "unknown",
                    model: state.item.model,
                    type: state.item.type,
                    total: calc.price,
                    days: calc.days,
                    dates: `${document.getElementById('inp-start').value} to ${document.getElementById('inp-end').value}`,
                    loc: addr,
                    time: document.getElementById('inp-time').value,
                    lang: state.lang,
                    timestamp: new Date().toISOString()
                };

                const btn = document.getElementById('btn-book');
                const originalText = btn.innerText;
                btn.disabled = true;
                btn.innerText = i18n[state.lang].loading;

                try {
                    console.log('Order data:', order);
                    
                    // –í —Ç–µ—Å—Ç–æ–≤–æ–º —Ä–µ–∂–∏–º–µ
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                    tg.showAlert(i18n[state.lang].sent);
                    
                    // –í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ:
                    // await fetch(GOOGLE_URL, { 
                    //     method: "POST", 
                    //     mode: "no-cors",
                    //     headers: { 'Content-Type': 'application/json' },
                    //     body: JSON.stringify(order) 
                    // });
                    
                    setTimeout(() => {
                        tg.close();
                    }, 1500);
                    
                } catch (e) {
                    console.error('Error:', e);
                    tg.showAlert(i18n[state.lang].error);
                    btn.disabled = false;
                    btn.innerText = originalText;
                }
            });
        }

        // Initialize
        setLang('ru');
        
        // Set min date for inputs
        const today = new Date().toISOString().split('T')[0];
        const startInput = document.getElementById('inp-start');
        const endInput = document.getElementById('inp-end');
        
        if (startInput) {
            startInput.min = today;
            startInput.value = today;
        }
        
        if (endInput) {
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            endInput.min = tomorrow.toISOString().split('T')[0];
            endInput.value = tomorrow.toISOString().split('T')[0];
        }
    </script>
</body>
</html>
