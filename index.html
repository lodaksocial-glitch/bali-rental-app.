<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bali Premium Rental</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        .premium-card { transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
        .premium-card:active { transform: scale(0.96); brightness: 0.8; }
        .glass-effect { background: rgba(0, 0, 0, 0.3); backdrop-filter: blur(8px); border: 1px solid rgba(255,255,255,0.1); }
        .lang-active { background: #2563eb; color: white; }
    </style>
</head>
<body class="bg-black text-white overflow-hidden">
    <div id="app" class="max-w-md mx-auto h-screen flex flex-col"></div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        // 1. ПЕРЕВОДЫ 1:1
        const i18n = {
            ru: {
                rent_bike: "Аренда байка",
                motorcycles: "МОТОЦИКЛЫ",
                starting_from: "От 100k IDR / день",
                rent_car: "Аренда авто",
                premium_cars: "ПРЕМИУМ АВТО",
                starting_car: "От 450k IDR / день",
                bikes: "Байки",
                cars: "Машины",
                pickup: "Дата получения",
                return: "Дата возврата",
                location: "Локация",
                total: "Итого за срок",
                book: "Забронировать",
                confirm_title: "Подтвердить бронирование",
                confirm_msg: "Подтверждаете бронь {model}?\nИтого: {total} IDR",
                select_dates: "Пожалуйста, выберите даты!",
                idr: "idr",
                day: "день",
                best_price: "ЛУЧШАЯ ЦЕНА"
            },
            en: {
                rent_bike: "Rent a Bike",
                motorcycles: "MOTORCYCLES",
                starting_from: "Starting from 100k IDR / day",
                rent_car: "Rent a Car",
                premium_cars: "PREMIUM CARS",
                starting_car: "Starting from 450k IDR / day",
                bikes: "Bikes",
                cars: "Cars",
                pickup: "Pick up date",
                return: "Return date",
                location: "Location",
                total: "Total for period",
                book: "Book now",
                confirm_title: "Confirm booking",
                confirm_msg: "Confirm booking for {model}?\nTotal: {total} IDR",
                select_dates: "Please select valid dates!",
                idr: "idr",
                day: "day",
                best_price: "BEST PRICE"
            }
        };

        const db = [
            { 
                id: 1, type: 'bike', model: 'Yamaha NMAX 2024', 
                prices: { day: 170000, week: 1000000, month: 2800000 },
                img: 'https://images.unsplash.com/photo-1599819811279-d5ad9cccf838?w=800',
                desc: { ru: "Черная серия. Полная страховка.", en: "Black edition. Full insurance." }
            },
            { 
                id: 2, type: 'car', model: 'Mitsubishi Xpander', 
                prices: { day: 650000, week: 3800000, month: 11000000 },
                img: 'https://images.unsplash.com/photo-1533473359331-0135ef1b58bf?w=800',
                desc: { ru: "7-местный кроссовер. Чистый салон.", en: "7-seater crossover. Clean interior." }
            }
        ];

        let state = JSON.parse(localStorage.getItem('bali_rent_state')) || { 
            step: 'type', 
            transport: null, 
            startDate: '', 
            endDate: '', 
            location: 'Canggu',
            lang: tg.initDataUnsafe?.user?.language_code === 'ru' ? 'ru' : 'en' 
        };

        function save() {
            localStorage.setItem('bali_rent_state', JSON.stringify(state));
            render();
        }

        const today = new Date().toISOString().split('T')[0];

        function calculateTotal(vehicle) {
            if (!state.startDate || !state.endDate) return 0;
            const start = new Date(state.startDate);
            const end = new Date(state.endDate);
            const diffDays = Math.ceil((end - start) / (1000 * 60 * 60 * 24));
            if (diffDays <= 0) return 0;
            if (diffDays >= 30) return Math.floor(diffDays * (vehicle.prices.month / 30));
            if (diffDays >= 7) return Math.floor(diffDays * (vehicle.prices.week / 7));
            return diffDays * vehicle.prices.day;
        }

        function render() {
            const app = document.getElementById('app');
            const t = i18n[state.lang];
            
            if (state.step === 'type') {
                app.style.overflowY = 'hidden';
                app.innerHTML = `
                    <div class="h-full w-full flex flex-col p-2 gap-2 relative">
                        <div class="absolute top-6 right-6 z-50 flex glass-effect rounded-full p-1">
                            <button onclick="state.lang='ru'; save()" class="px-3 py-1 rounded-full text-[10px] font-bold ${state.lang === 'ru' ? 'lang-active' : ''}">RU</button>
                            <button onclick="state.lang='en'; save()" class="px-3 py-1 rounded-full text-[10px] font-bold ${state.lang === 'en' ? 'lang-active' : ''}">EN</button>
                        </div>

                        <div onclick="go('bike')" class="relative flex-1 rounded-[40px] overflow-hidden premium-card">
                            <img src="https://images.unsplash.com/photo-1558981403-c5f9899a28bc?q=80&w=1000&auto=format&fit=crop" class="absolute inset-0 w-full h-full object-cover">
                            <div class="absolute inset-0 bg-gradient-to-t from-black via-transparent to-transparent"></div>
                            <div class="absolute bottom-10 left-8">
                                <span class="glass-effect px-4 py-1 rounded-full text-[10px] font-bold tracking-[0.2em] uppercase">${t.rent_bike}</span>
                                <h2 class="text-4xl font-black mt-2 italic tracking-tighter">${t.motorcycles}</h2>
                                <p class="text-gray-300 text-sm mt-1">${t.starting_from}</p>
                            </div>
                        </div>

                        <div onclick="go('car')" class="relative flex-1 rounded-[40px] overflow-hidden premium-card">
                            <img src="https://images.unsplash.com/photo-1503376780353-7e6692767b70?q=80&w=1000&auto=format&fit=crop" class="absolute inset-0 w-full h-full object-cover">
                            <div class="absolute inset-0 bg-gradient-to-t from-black via-transparent to-transparent"></div>
                            <div class="absolute bottom-10 left-8">
                                <span class="glass-effect px-4 py-1 rounded-full text-[10px] font-bold tracking-[0.2em] uppercase">${t.rent_car}</span>
                                <h2 class="text-4xl font-black mt-2 italic tracking-tighter">${t.premium_cars}</h2>
                                <p class="text-gray-300 text-sm mt-1">${t.starting_car}</p>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                const items = db.filter(v => v.type === state.transport);
                app.style.overflowY = 'auto';
                app.innerHTML = `
                    <div class="p-4 bg-[#f8f9fb] min-h-screen text-slate-900">
                        <div class="flex items-center justify-between mb-6 pt-4">
                            <button onclick="state.step='type'; render()" class="bg-white shadow-lg p-3 rounded-2xl text-blue-600">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
                            </button>
                            <h2 class="text-xl font-black uppercase tracking-widest">${state.transport === 'bike' ? t.bikes : t.cars}</h2>
                            <div onclick="state.lang = state.lang === 'ru' ? 'en' : 'ru'; save()" class="bg-white shadow-md px-3 py-1 rounded-xl font-bold text-xs cursor-pointer">${state.lang.toUpperCase()}</div>
                        </div>

                        <div class="bg-white p-6 rounded-[32px] shadow-xl mb-8 border border-gray-100">
                            <div class="grid grid-cols-2 gap-4 mb-4">
                                <div>
                                    <p class="text-[10px] font-black text-gray-400 uppercase ml-2 mb-1">${t.pickup}</p>
                                    <input type="date" min="${today}" value="${state.startDate}" onchange="state.startDate=this.value; save()" class="w-full bg-slate-50 p-3 rounded-2xl text-[10px] font-bold border-none outline-none appearance-none">
                                </div>
                                <div>
                                    <p class="text-[10px] font-black text-gray-400 uppercase ml-2 mb-1">${t.return}</p>
                                    <input type="date" min="${state.startDate || today}" value="${state.endDate}" onchange="state.endDate=this.value; save()" class="w-full bg-slate-50 p-3 rounded-2xl text-[10px] font-bold border-none outline-none appearance-none">
                                </div>
                            </div>
                            <p class="text-[10px] font-black text-gray-400 uppercase ml-2 mb-1">${t.location}</p>
                            <select onchange="state.location=this.value; save()" class="w-full bg-slate-50 p-3 rounded-2xl text-xs font-bold border-none outline-none appearance-none">
                                <option value="Canggu">Canggu / Seminyak</option>
                                <option value="Uluwatu">Uluwatu / Bukit</option>
                                <option value="Ubud">Ubud Central</option>
                            </select>
                        </div>

                        <div class="space-y-8">
                            ${items.map(v => {
                                const total = calculateTotal(v);
                                return `
                                <div class="bg-white rounded-[40px] overflow-hidden shadow-2xl border border-gray-50">
                                    <div class="relative h-64">
                                        <img src="${v.img}" class="w-full h-full object-cover">
                                        <div class="absolute top-4 right-4 bg-white/90 backdrop-blur px-4 py-2 rounded-2xl font-black text-[10px] text-blue-600 shadow-lg italic">
                                            ${t.best_price}
                                        </div>
                                    </div>
                                    <div class="p-8">
                                        <h3 class="text-3xl font-black text-slate-800 leading-tight">${v.model}</h3>
                                        <p class="text-gray-400 text-sm mt-2 mb-6">${v.desc[state.lang]}</p>
                                        
                                        <div class="flex items-end justify-between">
                                            <div>
                                                <p class="text-[10px] font-black text-gray-400 uppercase mb-1">${t.total}</p>
                                                <p class="text-2xl font-black text-blue-600">${total > 0 ? total.toLocaleString() : '—'} <span class="text-xs font-bold text-gray-400 uppercase">${t.idr}</span></p>
                                            </div>
                                            <button onclick="finishOrder('${v.model}', ${total})" class="bg-slate-900 text-white px-6 py-4 rounded-2xl font-black text-[10px] uppercase tracking-widest active:scale-90 transition-all shadow-xl shadow-slate-200">${t.book}</button>
                                        </div>
                                    </div>
                                </div>`;
                            }).join('')}
                        </div>
                    </div>
                `;
            }
        }

        function finishOrder(model, total) {
            const t = i18n[state.lang];
            if (total === 0) return tg.showAlert(t.select_dates);
            const msg = t.confirm_msg.replace('{model}', model).replace('{total}', total.toLocaleString());
            tg.showConfirm(msg, (ok) => {
                if(ok) tg.sendData(JSON.stringify({ model, total, dates: `${state.startDate}/${state.endDate}`, loc: state.location, lang: state.lang }));
            });
        }

        function go(type) { state.transport = type; state.step = 'models'; save(); }
        render();
    </script>
</body>
</html>
