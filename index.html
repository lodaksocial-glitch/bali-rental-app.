<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bali Elite Pro</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap');
        body { font-family: 'Inter', sans-serif; background: #0f172a; color: #1e293b; -webkit-tap-highlight-color: transparent; overscroll-behavior: none; }
        .page { display: none; min-height: 100vh; animation: fadeIn 0.2s ease; padding-bottom: 120px; }
        .active { display: flex; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .card-press:active { transform: scale(0.97); transition: 0.1s; opacity: 0.9; }
        .price-btn { transition: all 0.2s; border: 1px solid #e2e8f0; cursor: pointer; }
        .price-btn:active { transform: scale(0.95); background: #eff6ff; border-color: #3b82f6; }
        .lang-btn { background: rgba(0,0,0,0.3); color: white; backdrop-filter: blur(4px); }
        .lang-active { background: #3b82f6; color: white; font-weight: 800; box-shadow: 0 4px 12px rgba(59,130,246,0.5); }
        ::-webkit-scrollbar { width: 0; }
    </style>
</head>
<body class="bg-[#0f172a]">

    <div id="app" class="max-w-md mx-auto relative min-h-screen bg-[#f8fafc] shadow-2xl overflow-hidden flex flex-col">
        
        <div class="absolute top-5 right-5 z-50 flex gap-2">
            <button onclick="setLang('ru')" id="btn-ru" class="lang-btn px-4 py-2 rounded-full text-xs font-bold transition-all border border-white/20">RU</button>
            <button onclick="setLang('en')" id="btn-en" class="lang-btn px-4 py-2 rounded-full text-xs font-bold transition-all border border-white/20">EN</button>
        </div>

        <div id="step-home" class="page active flex-col bg-[#0f172a] h-full relative">
            <div class="px-6 pt-16 pb-6">
                <h1 class="text-4xl font-black italic uppercase tracking-tighter text-white">Bali Elite</h1>
                <p class="text-blue-500 text-xs font-bold uppercase tracking-widest mt-1">Rent & Ride</p>
            </div>
            <div class="flex-1 flex flex-col gap-6 px-4 pb-10 overflow-y-auto">
                <div onclick="showCategory('bike')" class="card-press relative h-64 rounded-[40px] overflow-hidden shadow-2xl bg-gray-900 cursor-pointer">
                    <img src="https://images.unsplash.com/photo-1609630875171-b1321377ee65?w=600&q=80" class="absolute inset-0 w-full h-full object-cover opacity-80">
                    <div class="absolute inset-0 bg-gradient-to-t from-black/90 via-transparent to-transparent"></div>
                    <div class="absolute bottom-8 left-8">
                        <span class="bg-blue-600 px-3 py-1 rounded-lg text-[10px] font-bold text-white uppercase tracking-wider mb-2 inline-block">Popular</span>
                        <h2 class="text-4xl font-black italic uppercase text-white leading-none" id="lbl-moto">Bikes</h2>
                    </div>
                </div>
                <div onclick="showCategory('car')" class="card-press relative h-64 rounded-[40px] overflow-hidden shadow-2xl bg-gray-900 cursor-pointer">
                    <img src="https://images.unsplash.com/photo-1549317661-bd32c8ce0db2?w=600&q=80" class="absolute inset-0 w-full h-full object-cover opacity-80">
                    <div class="absolute inset-0 bg-gradient-to-t from-black/90 via-transparent to-transparent"></div>
                    <div class="absolute bottom-8 left-8">
                        <h2 class="text-4xl font-black italic uppercase text-white leading-none" id="lbl-cars">Cars</h2>
                    </div>
                </div>
            </div>
        </div>

        <div id="step-list" class="page flex-col bg-[#f1f5f9] pt-20">
            <div class="fixed top-0 left-0 w-full max-w-md bg-white/90 backdrop-blur-md p-4 shadow-sm z-40 flex items-center justify-between">
                <button onclick="showPage('step-home')" class="w-10 h-10 flex items-center justify-center rounded-xl bg-slate-100 text-slate-900 font-bold active:bg-slate-200">←</button>
                <h2 class="text-sm font-black uppercase tracking-widest text-slate-800" id="lbl-cat-title">Models</h2>
                <div class="w-10"></div>
            </div>
            <div id="items-container" class="px-4 space-y-4 pb-24"></div>
        </div>

        <div id="step-details" class="page flex-col bg-white h-full relative">
            <button onclick="showPage('step-list')" class="absolute top-4 left-4 z-20 bg-white/50 backdrop-blur p-2 rounded-full shadow-lg font-bold w-10 h-10 text-black">←</button>
            <div class="h-[35vh] w-full bg-gray-200 relative">
                <img id="det-img" src="" class="w-full h-full object-cover">
            </div>
            <div class="px-6 -mt-6 relative z-10 flex-1 flex flex-col">
                <div class="flex justify-between items-start mb-2">
                    <h1 id="det-model" class="text-2xl font-black text-slate-900 leading-tight">Model</h1>
                    <span id="det-specs" class="bg-blue-100 text-blue-700 px-2 py-1 rounded-lg text-[9px] font-bold uppercase">Specs</span>
                </div>
                <p id="det-desc" class="text-xs text-gray-500 mb-5">Description</p>
                <div class="grid grid-cols-3 gap-2 mb-6">
                    <div onclick="setDuration(1)" class="price-btn text-center p-2 rounded-xl bg-white shadow-sm">
                        <div class="text-[8px] uppercase font-bold text-gray-400 mb-1" id="lbl-day">Day</div>
                        <div id="p-day" class="font-bold text-slate-900 text-xs">-</div>
                    </div>
                    <div onclick="setDuration(7)" class="price-btn text-center p-2 rounded-xl bg-blue-50 border-blue-100 shadow-sm">
                        <div class="text-[8px] uppercase font-bold text-blue-500 mb-1" id="lbl-week">Week</div>
                        <div id="p-week" class="font-bold text-blue-700 text-xs">-</div>
                    </div>
                    <div onclick="setDuration(30)" class="price-btn text-center p-2 rounded-xl bg-white shadow-sm">
                        <div class="text-[8px] uppercase font-bold text-gray-400 mb-1" id="lbl-month">Month</div>
                        <div id="p-month" class="font-bold text-slate-900 text-xs">-</div>
                    </div>
                </div>
                <div class="bg-slate-50 p-4 rounded-3xl border border-slate-100 space-y-3 mb-20">
                    <div class="grid grid-cols-2 gap-3">
                        <input type="date" id="inp-start" class="bg-white p-3 rounded-xl text-xs font-bold border border-gray-200 outline-none" onchange="calcTotal()">
                        <input type="date" id="inp-end" class="bg-white p-3 rounded-xl text-xs font-bold border border-gray-200 outline-none" onchange="calcTotal()">
                    </div>
                    <input type="text" id="inp-addr" placeholder="Hotel / Villa Address" class="w-full bg-white p-3 rounded-xl text-xs border border-gray-200 outline-none">
                </div>
            </div>
            <div class="fixed bottom-0 left-0 w-full z-50 p-4 bg-white border-t border-gray-100 flex items-center justify-between shadow-lg">
                <div>
                    <div class="text-[10px] font-bold text-gray-400 uppercase" id="lbl-total-days">0 Days</div>
                    <div id="display-total" class="text-xl font-black text-blue-600">0 IDR</div>
                </div>
                <button onclick="finishOrder()" id="btn-book" class="bg-blue-600 text-white px-8 py-3 rounded-2xl font-black uppercase text-xs active:scale-95 transition-all">Book</button>
            </div>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();

        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyTgpmdGn25HP3O_2mzO9GV3SCCBGRPLqKETmvzBnLry6KLYJeDGA9Zml-7_w5g53oL/exec
        const db = [
            { id: 1, type: 'bike', model: 'Yamaha NMax 155 (2022)', price: {d:150000, w:1000000, m:2500000}, img: 'https://yamaha-motor.id/wp-content/uploads/2023/04/Nmax-ABS-2-600x400.png', specs: 'Standard', desc: {ru: 'Классический NMax 155.', en: 'Classic NMax 155.'}},
            { id: 2, type: 'bike', model: 'Yamaha NMax New (2025)', price: {d:200000, w:1300000, m:2700000}, img: 'https://brdsg.com/img/800/bw5d48ohbw5jup2tq9_3/CT79WSw0akV4fenCTIXNpDJVwe6BJTXCLRs2cLNUJNQ.png', specs: 'New Gen | ABS', desc: {ru: 'Новый кузов, LED, Bluetooth.', en: 'New body, LED, Bluetooth.'}},
            { id: 3, type: 'bike', model: 'Yamaha NMax (2026)', price: {d:200000, w:1300000, m:2700000}, img: 'https://imgcdn.oto.com/large/gallery/exterior/84/2967/yamaha-nmax-turbo-slant-rear-view-full-image-125296.jpg', specs: '2026 Model', desc: {ru: 'Самая свежая модель.', en: 'Latest model.'}},
            { id: 4, type: 'bike', model: 'Yamaha XMax 250 (2023)', price: {d:249000, w:1900000, m:3500000}, img: 'https://yamaha-motor.id/wp-content/uploads/2023/04/Xmax-2-600x400.png', specs: '250cc | Maxi', desc: {ru: 'Комфорт и мощь.', en: 'Comfort and power.'}},
            { id: 5, type: 'bike', model: 'XMax Tech Max (2026)', price: {d:250000, w:2700000, m:4200000}, img: 'https://www.yamahamotor.co.id/wp-content/uploads/2024/10/Yamaha-nmax-Turbo-Tech-MAX-Magma-Black-1.png', specs: 'Tech Max', desc: {ru: 'Премиум версия.', en: 'Premium version.'}},
            { id: 6, type: 'bike', model: 'Honda ADV 160', price: {d:200000, w:1300000, m:2700000}, img: 'https://imgcdn.oto.com/large/gallery/exterior/73/2617/honda-adv-160-slant-rear-view-full-image-937505.jpg', specs: 'Adventure', desc: {ru: 'Внедорожный скутер.', en: 'Off-road scooter.'}},
            { id: 7, type: 'car', model: 'Honda Brio', price: {d:350000, w:2000000, m:5000000}, img: 'https://upload.wikimedia.org/wikipedia/commons/2/2e/2020_Honda_Brio_Satya_S_1.2_DD1_%2820211001%29_01.jpg', specs: 'Compact', desc: {ru: 'Маленькая, юркая.', en: 'Small, agile.'}},
            { id: 8, type: 'car', model: 'Mitsubishi Xpander', price: {d:450000, w:3500000, m:8000000}, img: 'https://cdn.motor1.com/images/mgl/A8J36/s1/2020-mitsubishi-xpander-cross.webp', specs: 'Premium MPV', desc: {ru: 'Просторный и мягкий.', en: 'Spacious and soft.'}}
        ];

        const i18n = {
            ru: { moto:"Мотоциклы", cars:"Авто", book:"Забронировать", day:"День", week:"Неделя", month:"Месяц", start:"Начало", end:"Конец" },
            en: { moto:"Bikes", cars:"Cars", book:"Book Now", day:"Day", week:"Week", month:"Month", start:"Start", end:"End" }
        };

        let state = { lang: 'ru', item: null };

        function setLang(l) {
            state.lang = l;
            document.getElementById('btn-ru').className = l==='ru'?'lang-btn px-4 py-2 rounded-full text-xs font-bold lang-active':'lang-btn px-4 py-2 rounded-full text-xs font-bold border border-white/20';
            document.getElementById('btn-en').className = l==='en'?'lang-btn px-4 py-2 rounded-full text-xs font-bold lang-active':'lang-btn px-4 py-2 rounded-full text-xs font-bold border border-white/20';
            updateUI();
        }

        function updateUI() {
            const t = i18n[state.lang];
            document.getElementById('lbl-moto').innerText = t.moto;
            document.getElementById('lbl-cars').innerText = t.cars;
            document.getElementById('btn-book').innerText = t.book;
            if(state.item) renderDetails(state.item);
        }

        function showPage(id) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            window.scrollTo(0,0);
        }

        function showCategory(type) {
            const container = document.getElementById('items-container');
            const items = db.filter(i => i.type === type);
            container.innerHTML = items.map(item => `
                <div onclick="openDetails(${item.id})" class="bg-white rounded-[20px] p-3 flex gap-3 shadow-sm border border-slate-100 active:scale-95 transition-all">
                    <div class="w-20 h-20 bg-gray-100 rounded-xl overflow-hidden"><img src="${item.img}" class="w-full h-full object-cover"></div>
                    <div class="flex-1 flex flex-col justify-center">
                        <h3 class="font-bold text-slate-800 text-base">${item.model}</h3>
                        <p class="text-[10px] font-bold text-blue-500 uppercase">${item.specs}</p>
                        <p class="text-xs text-gray-400">${(item.price.d/1000).toFixed(0)}k / day</p>
                    </div>
                </div>
            `).join('');
            document.getElementById('lbl-cat-title').innerText = type==='bike'?i18n[state.lang].moto:i18n[state.lang].cars;
            showPage('step-list');
        }

        function openDetails(id) {
            state.item = db.find(i => i.id === id);
            renderDetails(state.item);
            showPage('step-details');
        }

        function renderDetails(item) {
            document.getElementById('det-img').src = item.img;
            document.getElementById('det-model').innerText = item.model;
            document.getElementById('det-specs').innerText = item.specs;
            document.getElementById('det-desc').innerText = item.desc[state.lang];
            const k = (n) => n >= 1000000 ? (n/1000000).toFixed(1)+'M' : (n/1000).toFixed(0)+'k';
            document.getElementById('p-day').innerText = k(item.price.d);
            document.getElementById('p-week').innerText = k(item.price.w);
            document.getElementById('p-month').innerText = k(item.price.m);
        }

        function setDuration(days) {
            const start = new Date();
            const end = new Date();
            end.setDate(start.getDate() + days);
            document.getElementById('inp-start').valueAsDate = start;
            document.getElementById('inp-end').valueAsDate = end;
            calcTotal();
        }

        function calcTotal() {
            const sVal = document.getElementById('inp-start').value;
            const eVal = document.getElementById('inp-end').value;
            if(!sVal || !eVal) return;
            const diff = new Date(eVal) - new Date(sVal);
            const days = Math.ceil(diff / (1000 * 60 * 60 * 24));
            if(days <= 0) return;
            let total = days >= 30 ? (state.item.price.m / 30) * days : days >= 7 ? (state.item.price.w / 7) * days : state.item.price.d * days;
            total = Math.ceil(total / 1000) * 1000;
            document.getElementById('display-total').innerText = total.toLocaleString() + " IDR";
            document.getElementById('lbl-total-days').innerText = days + (state.lang==='ru'?' дн':' days');
            return { total, days };
        }

        async function finishOrder() {
            const calc = calcTotal();
            const addr = document.getElementById('inp-addr').value;
            if(!calc || !addr) return alert("Заполните все поля!");

            const btn = document.getElementById('btn-book');
            btn.innerText = "...";
            btn.disabled = true;

            const data = {
                model: state.item.model,
                total: calc.total,
                days: calc.days,
                dates: document.getElementById('inp-start').value + ' - ' + document.getElementById('inp-end').value,
                address: addr
            };

            try {
                await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    body: JSON.stringify(data)
                });
                tg.close();
            } catch (e) {
                alert("Error: " + e);
                btn.innerText = "Book";
                btn.disabled = false;
            }
        }

        setLang('ru');
    </script>
</body>
</html>
