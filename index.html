<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bali Elite Pro</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .vehicle-card { transition: all 0.2s ease; }
        .active-ring { border: 3px solid #2563eb !important; }
        input[type="date"]::-webkit-inner-spin-button,
        input[type="date"]::-webkit-calendar-picker-indicator { opacity: 0.5; }
    </style>
</head>
<body class="bg-[#f8f9fb] text-slate-900 overflow-x-hidden">
    <div id="app" class="max-w-md mx-auto min-h-screen flex flex-col pb-10"></div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        // 1. –†–ê–°–®–ò–†–ï–ù–ù–ê–Ø –ë–î (–¶–µ–Ω—ã: –¥–µ–Ω—å, –Ω–µ–¥–µ–ª—è, –º–µ—Å—è—Ü)
        const db = [
            { 
                id: 1, type: 'bike', model: 'Yamaha NMAX 2024', 
                prices: { day: 170000, week: 1000000, month: 2800000 },
                img: 'https://images.unsplash.com/photo-1599819811279-d5ad9cccf838?w=800',
                desc: '–ù–æ–≤—ã–π –±–∞–π–∫, ABS, –±–æ–ª—å—à–æ–π –±–∞–≥–∞–∂–Ω–∏–∫.'
            },
            { 
                id: 2, type: 'car', model: 'Toyota Avanza', 
                prices: { day: 450000, week: 2800000, month: 8500000 },
                img: 'https://images.unsplash.com/photo-1533473359331-0135ef1b58bf?w=800',
                desc: '7 –º–µ—Å—Ç, –∫–æ–Ω–¥–∏—Ü–∏–æ–Ω–µ—Ä, –∏–¥–µ–∞–ª–µ–Ω –¥–ª—è —Å–µ–º—å–∏.'
            }
        ];

        let state = {
            step: 'type',
            transport: null,
            startDate: '',
            endDate: '',
            location: 'Canggu',
            helmets: 1,
            holder: false
        };

        // –¢–ï–ö–£–©–ê–Ø –î–ê–¢–ê –î–õ–Ø –í–ê–õ–ò–î–ê–¶–ò–ò
        const today = new Date().toISOString().split('T')[0];

        function calculateTotal(vehicle) {
            if (!state.startDate || !state.endDate) return 0;
            const start = new Date(state.startDate);
            const end = new Date(state.endDate);
            const diffDays = Math.ceil((end - start) / (1000 * 60 * 60 * 24));
            
            if (diffDays <= 0) return 0;

            if (diffDays >= 30) return Math.floor(diffDays * (vehicle.prices.month / 30));
            if (diffDays >= 7) return Math.floor(diffDays * (vehicle.prices.week / 7));
            return diffDays * vehicle.prices.day;
        }

        function render() {
            const app = document.getElementById('app');
            if (state.step === 'type') {
                app.innerHTML = `
                    <div class="p-6">
                        <h1 class="text-4xl font-black mb-6 mt-4">Bali Booking</h1>
                        <div class="space-y-4">
                            <div onclick="go('bike')" class="bg-white rounded-[30px] p-6 shadow-xl border-2 border-transparent hover:border-blue-500">
                                <span class="text-4xl">üõµ</span> <h2 class="text-2xl font-bold inline ml-3">–ë–∞–π–∫–∏</h2>
                            </div>
                            <div onclick="go('car')" class="bg-white rounded-[30px] p-6 shadow-xl border-2 border-transparent hover:border-blue-500">
                                <span class="text-4xl">üöó</span> <h2 class="text-2xl font-bold inline ml-3">–ú–∞—à–∏–Ω—ã</h2>
                            </div>
                        </div>
                    </div>`;
            } else {
                const items = db.filter(v => v.type === state.transport);
                app.innerHTML = `
                    <div class="p-4">
                        <button onclick="state.step='type'; render()" class="mb-4 font-bold text-blue-600">‚Üê –ù–∞–∑–∞–¥</button>
                        
                        <div class="bg-white p-5 rounded-[25px] shadow-sm mb-4 border border-gray-100">
                            <h3 class="text-[11px] font-black uppercase text-gray-400 mb-2">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞—Ä–µ–Ω–¥—ã</h3>
                            <div class="grid grid-cols-2 gap-3 mb-3">
                                <input type="date" min="${today}" value="${state.startDate}" onchange="state.startDate=this.value; render()" class="bg-slate-50 p-3 rounded-xl text-xs font-bold">
                                <input type="date" min="${state.startDate || today}" value="${state.endDate}" onchange="state.endDate=this.value; render()" class="bg-slate-50 p-3 rounded-xl text-xs font-bold">
                            </div>
                            <select onchange="state.location=this.value; render()" class="w-full bg-slate-50 p-3 rounded-xl text-xs font-bold border-none leading-tight">
                                <option value="Canggu">–ß–∞–Ω–≥—É (Free)</option>
                                <option value="Uluwatu">–£–ª—É–≤–∞—Ç—É (50k)</option>
                                <option value="Ubud">–£–±—É–¥ (100k)</option>
                            </select>
                        </div>

                        <div class="space-y-6">
                            ${items.map(v => {
                                const total = calculateTotal(v);
                                return `
                                <div class="bg-white rounded-[35px] overflow-hidden shadow-lg border border-gray-50">
                                    <img src="${v.img}" class="w-full h-52 object-cover">
                                    <div class="p-6">
                                        <h3 class="text-2xl font-black mb-1">${v.model}</h3>
                                        <p class="text-gray-400 text-xs mb-4">${v.desc}</p>
                                        
                                        <div class="bg-slate-50 p-3 rounded-2xl mb-4 text-[10px] grid grid-cols-3 text-center font-bold">
                                            <div class="border-r">–î–µ–Ω—å<br><span class="text-blue-600">${v.prices.day/1000}k</span></div>
                                            <div class="border-r">–ù–µ–¥–µ–ª—è<br><span class="text-blue-600">${v.prices.week/1000}k</span></div>
                                            <div>–ú–µ—Å—è—Ü<br><span class="text-blue-600">${(v.prices.month/1000).toFixed(0)}k</span></div>
                                        </div>

                                        <div class="flex items-center justify-between mb-4">
                                            <span class="text-xs font-bold text-gray-500 uppercase">–ò—Ç–æ–≥–æ –∑–∞ —Å—Ä–æ–∫:</span>
                                            <span class="text-xl font-black text-blue-600">${total > 0 ? total.toLocaleString() : '‚Äî'} IDR</span>
                                        </div>

                                        <button onclick="finishOrder('${v.model}', ${total})" class="w-full bg-blue-600 text-white py-4 rounded-2xl font-black tracking-widest active:scale-95 transition-all">–ó–ê–ë–†–û–ù–ò–†–û–í–ê–¢–¨</button>
                                    </div>
                                </div>`;
                            }).join('')}
                        </div>
                    </div>`;
            }
        }

        function finishOrder(model, total) {
            if (total === 0) return tg.showAlert("–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞—Ç—ã!");
            
            const order = {
                model, total,
                dates: `${state.startDate} / ${state.endDate}`,
                loc: state.location
            };
            
            tg.showConfirm(`–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç–µ –±—Ä–æ–Ω—å ${model} –∑–∞ ${total.toLocaleString()} IDR?\n–î–æ—Å—Ç–∞–≤–∫–∞: ${state.location}`, (ok) => {
                if(ok) tg.sendData(JSON.stringify(order));
            });
        }

        function go(type) { state.transport = type; state.step = 'models'; render(); }
        render();
    </script>
</body>
</html>
